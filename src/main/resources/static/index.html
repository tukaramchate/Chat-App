<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Spring Boot Chat App</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        #chat { border: 1px solid #ccc; height: 300px; overflow-y: scroll; padding: 10px; margin-bottom: 10px; }
        .message { margin: 5px 0; }
        .sender { font-weight: bold; }
    </style>
</head>
<body>
<h2>Spring Boot WebSocket Chat</h2>
<div>
    <label>Username: </label>
    <input type="text" id="username" placeholder="Enter your name">
    <button onclick="connect()">Connect</button>
</div>
<div id="chat"></div>
<div>
    <input type="text" id="message" placeholder="Type a message..." onkeypress="if(event.key==='Enter') sendMessage()">
    <button onclick="sendMessage()">Send</button>
</div>

<script>
    let stompClient = null;
    let roomId = "general"; // default chat room

    function connect() {
        const socket = new SockJS('/ws');
        stompClient = Stomp.over(socket);

        stompClient.connect({}, function () {
            const username = document.getElementById("username").value;
            if (!username) {
                alert("Enter a username first!");
                return;
            }

            stompClient.subscribe('/topic/' + roomId, function (messageOutput) {
                const msg = JSON.parse(messageOutput.body);
                showMessage(msg.sender, msg.content);
            });

            stompClient.send("/app/chat.addUser/" + roomId, {}, JSON.stringify({
                sender: username,
                type: "JOIN"
            }));
        });
    }

    function sendMessage() {
        const messageInput = document.getElementById("message");
        const content = messageInput.value.trim();
        const username = document.getElementById("username").value;

        if (content && stompClient) {
            const chatMessage = {
                sender: username,
                content: content,
                type: "CHAT"
            };
            stompClient.send("/app/chat.send/" + roomId, {}, JSON.stringify(chatMessage));
            messageInput.value = '';
        }
    }

    function showMessage(sender, content) {
        const chat = document.getElementById("chat");
        const msgElement = document.createElement("div");
        msgElement.classList.add("message");
        msgElement.innerHTML = `<span class="sender">${sender}:</span> ${content}`;
        chat.appendChild(msgElement);
        chat.scrollTop = chat.scrollHeight;
    }
</script>
</body>
</html>
